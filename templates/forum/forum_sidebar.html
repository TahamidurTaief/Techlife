{% load static %}

<style>
    .custom-scroll::-webkit-scrollbar {
        width: 5px;
    }
    
    .custom-scroll::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .custom-scroll::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 10px;
    }
    
    .custom-scroll::-webkit-scrollbar-thumb:hover {
        background: #888;
    }
    
    .question-modal-container::-webkit-scrollbar {
        display: none;
    }
    
    .question-modal-container {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    
    .question-modal-overlay {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s ease, visibility 0.4s ease;
    }
    
    .question-modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    
    .question-modal-container {
        transform: scale(0.7) translateY(-50px);
        opacity: 0;
        transition: transform 0.4s ease, opacity 0.4s ease;
    }
    
    .question-modal-overlay.active .question-modal-container {
        transform: scale(1) translateY(0);
        opacity: 1;
    }
    
    .question-close-btn {
        transition: all 0.3s ease;
    }
    
    .question-close-btn:hover {
        transform: rotate(90deg);
    }
    /* Sidebar backdrop for mobile */
    
    #sidebarBackdrop {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    #sidebarBackdrop.active {
        opacity: 1;
        visibility: visible;
    }
</style>

<!-- Mobile Backdrop -->
<div id="sidebarBackdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden"></div>

<!-- Sidebar -->
<div id="sidebar" class="fixed md:sticky top-0 md:top-16 left-0 w-64 sm:w-72 md:w-60 lg:w-64 h-screen md:h-[calc(100vh-4rem)] bg-white shadow-lg md:shadow-sm border-r border-gray-200 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-40 md:z-0">
    <!-- Scrollable Inner Content -->
    <div class="h-full overflow-y-auto custom-scroll">
        <!-- Top Links -->
        <div class="pt-4 md:pt-0">
            <a href="{% url 'homepage' %}" class="flex items-center gap-3 mb-1 ml-4 sm:ml-6 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <svg rpl="" fill="currentColor" height="20" icon-name="home-outline" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
                    <path d="M17.877 8.525a1.584 1.584 0 00-.35-.52l-6.395-6.352a1.602 1.602 0 00-1.13-.467h-.003a1.6 1.6 0 00-1.13.467L2.473 8.005A1.604 1.604 0 002 9.14v6.374a3.3 3.3 0 003.3 3.3h9.4a3.3 3.3 0 003.3-3.3V9.14c0-.211-.042-.42-.123-.615zM16.2 15.514c0 .827-.673 1.5-1.5 1.5H11v-5.575H9v5.575H5.3c-.827 0-1.5-.673-1.5-1.5v-6.29L10 3.066l6.2 6.158v6.29z"></path>
                </svg>
                <span class="text-sm sm:text-base">Home</span>
            </a>

            <a hx-get="{% url 'popular_question' %}" hx-target="#blog_post_form" hx-swap="innerHTML" hx-push-url="true" class="flex items-center gap-3 mb-2 p-2 ml-4 sm:ml-6 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                <svg rpl="" class="rpl-rtl-icon flex-shrink-0" fill="currentColor" height="20" icon-name="popular-outline" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 1a9 9 0 00-9 9 9 9 0 009 9 9 9 0 009-9 9 9 0 00-9-9zm0 16.2c-1.66 0-3.186-.57-4.405-1.517l6.476-6.477V13h1.801V7.028a.9.9 0 00-.9-.9h-5.94v1.801h3.771l-6.481 6.482a7.154 7.154 0 01-1.521-4.41c0-3.97 3.23-7.2 7.2-7.2s7.2 3.23 7.2 7.2-3.23 7.2-7.2 7.2L10 17.2z"></path>
                </svg>
                <span class="text-sm sm:text-base">Popular</span>
            </a>

            <a hx-get="{% url 'questions_list' %}" hx-target="#blog_post_form" hx-swap="innerHTML" hx-push-url="true" class="flex items-center gap-3 mb-2 p-2 ml-4 sm:ml-6 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                <svg rpl="" class="rpl-rtl-icon flex-shrink-0" fill="currentColor" height="20" icon-name="all-outline" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 1a9 9 0 10.001 18.001A9 9 0 0010 1zm4.9 14.26V7.04h-1.8v9.45c-.68.33-1.42.55-2.2.65V10H9.1v7.14c-.78-.1-1.52-.32-2.2-.65v-3.46H5.1v2.23C3.69 13.94 2.8 12.08 2.8 10c0-3.97 3.23-7.2 7.2-7.2s7.2 3.23 7.2 7.2c0 2.08-.89 3.95-2.3 5.26z"></path>
                </svg>
                <span class="text-sm sm:text-base">Questions</span>
            </a>

            <a hx-get="{% url 'forum_all_user_list' %}" hx-target="#blog_post_form" hx-swap="innerHTML" hx-push-url="true" class="flex items-center gap-3 mb-2 p-2 ml-4 sm:ml-6 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                <svg aria-hidden="true" class="svg-icon iconPeople flex-shrink-0" width="18" height="18" viewBox="0 0 18 18">
                    <path d="M17 14c0 .44-.45 1-1 1H9a1 1 0 0 1-1-1H2c-.54 0-1-.56-1-1 0-2.63 3-4 3-4s.23-.4 0-1c-.84-.62-1.06-.59-1-3s1.37-3 2.5-3 2.44.58 2.5 3-.16 2.38-1 3c-.23.59 0 1 0 1s1.55.71 2.42 2.09c.78-.72 1.58-1.1 1.58-1.1s.23-.4 0-1c-.84-.61-1.06-.58-1-3s1.37-3 2.5-3 2.44.59 2.5 3c.05 2.42-.16 2.39-1 3-.23.6 0 1 0 1s3 1.38 3 4"></path>
                </svg>
                <span class="text-sm sm:text-base">Users</span>
            </a>
        </div>

        <hr class="my-4 mx-4" />

        <!-- Accordion Section - Custom Feed -->
        <div x-data="{ open: false }" class="px-4">
            <button @click="open = !open" class="w-full flex justify-between items-center p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <span class="text-base sm:text-lg font-medium text-gray-400">Custom Feed</span>
                <svg :class="{'rotate-180': open}" class="h-4 w-4 text-gray-400 transition-transform flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </button>

            <div x-show="open" class="mt-2 space-y-1">
                <a href="javascript:void(0)" onclick="openQuestionModal()" class="open-modal-trigger flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                    <svg fill="currentColor" height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
                        <path d="M17.1 9.1h-6.2V2.9c0-.5-.4-.9-.9-.9s-.9.4-.9.9v6.2H2.9c-.5 0-.9.4-.9.9s.4.9.9.9h6.2v6.2c0 .5.4.9.9.9s.9-.4.9-.9v-6.2h6.2c.5 0 .9-.4.9-.9s-.4-.9-.9-.9z"></path>
                    </svg>
                    <span class="text-sm sm:text-base">Create</span>
                </a>
            </div>
        </div>

        <hr class="my-4 mx-4" />

        <!-- Accordion Section - Resources -->
        <div x-data="{ open: true }" class="px-4">
            <button @click="open = !open" class="w-full flex justify-between items-center p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <span class="text-base sm:text-lg font-medium text-gray-400">Resources</span>
                <svg :class="{'rotate-180': open}" class="h-4 w-4 text-gray-400 transition-transform flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </button>

            <div x-show="open" class="mt-2 space-y-1">
                <a href="{% url 'blogs' %}" class="flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <svg rpl="" class="rpl-rtl-icon flex-shrink-0" fill="currentColor" height="20" icon-name="topic-reading-outline" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18.278 2.632a2.265 2.265 0 00-1.698-.627c-2.95.165-4.67.827-6.58 1.987-1.91-1.16-3.63-1.822-6.581-1.987a2.273 2.273 0 00-1.697.627A2.327 2.327 0 001 4.312v9.428c0 1.23.966 2.241 2.198 2.302 2.724.136 4.175.715 5.761 1.67a2.019 2.019 0 002.082 0c1.586-.955 3.037-1.534 5.761-1.67a2.308 2.308 0 002.199-2.302V4.312c0-.632-.264-1.244-.723-1.68zM3.288 14.238a.507.507 0 01-.488-.498V4.312c0-.189.1-.312.16-.368a.487.487 0 01.333-.136h.027c2.625.147 4.043.692 5.78 1.752v10.158c-1.535-.819-3.177-1.348-5.813-1.48h.001zM17.2 13.74a.505.505 0 01-.488.498c-2.635.132-4.277.661-5.812 1.48V5.56c1.736-1.06 3.155-1.606 5.779-1.752a.47.47 0 01.361.136c.06.056.16.18.16.368v9.427zM12 6.95c1.131-.469 2.385-.765 4-.9v1.794c-1.678.152-2.842.5-4 1.081V6.95zm0 4.064c1.131-.469 2.385-.765 4-.9v1.794c-1.678.152-2.842.5-4 1.081v-1.975z"></path>
                    </svg>
                    <span class="text-sm sm:text-base">Blogs</span>
                </a>

                <a href="javascript:void(0)" onclick="openModal('followersModalOverlay')" class="flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <svg class="text-gray-600 flex-shrink-0" fill="currentColor" height="20" width="20" viewBox="0 0 20 20">
                        <path d="M7.5 8a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm0 1.5c-2.33 0-7 1.17-7 3.5V15h14v-1.5c0-2.33-4.67-3.5-7-3.5zM13.5 8a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm.75 1.5c-.28 0-.59.02-.92.05 1.11.81 1.92 1.87 1.92 3.2V15h5v-1.5c0-2.33-3.58-3.5-6-3.5z"/>
                    </svg>
                    <span class="text-sm sm:text-base">Followers</span>
                </a>

                <a href="javascript:void(0)" onclick="openModal('followingModalOverlay')" class="flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <svg class="text-gray-600 flex-shrink-0" fill="currentColor" height="20" width="20" viewBox="0 0 20 20">
                        <path d="M10 10a4 4 0 100-8 4 4 0 000 8zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4zm6-5l-1.41-1.41L12 8.17 10.59 6.76 9.17 8.17l2.83 2.83L16 7z"/>
                    </svg>
                    <span class="text-sm sm:text-base">Following</span>
                </a>
            </div>
        </div>

        <!-- Bottom Links -->
        <hr class="my-4 mx-4" />

        <div class="px-4 pb-6">
            <a href="{% url 'homepage' %}" class="flex items-center gap-3 mb-2 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <svg rpl="" class="rpl-rtl-icon flex-shrink-0" fill="currentColor" height="20" icon-name="open-book" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.278 2.632a2.265 2.265 0 00-1.698-.627c-2.95.165-4.67.827-6.58 1.987-1.91-1.16-3.63-1.822-6.581-1.987a2.273 2.273 0 00-1.697.627A2.327 2.327 0 001 4.312v9.428c0 1.23.966 2.241 2.198 2.302 2.724.136 4.175.715 5.761 1.67a2.019 2.019 0 002.082 0c1.586-.955 3.037-1.534 5.761-1.67a2.308 2.308 0 002.199-2.302V4.312c0-.632-.264-1.244-.723-1.68zM3.288 14.238a.507.507 0 01-.488-.498V4.312c0-.189.1-.312.16-.368a.487.487 0 01.333-.136h.027c2.625.147 4.043.692 5.78 1.752v10.158c-1.535-.819-3.177-1.348-5.813-1.48h.001zM17.2 13.74a.505.505 0 01-.488.498c-2.635.132-4.277.661-5.812 1.48V5.56c1.736-1.06 3.155-1.606 5.779-1.752a.47.47 0 01.361.136c.06.056.16.18.16.368v9.427zM12 6.95c1.131-.469 2.385-.765 4-.9v1.794c-1.678.152-2.842.5-4 1.081V6.95zm0 4.064c1.131-.469 2.385-.765 4-.9v1.794c-1.678.152-2.842.5-4 1.081v-1.975z"></path>
                </svg>
                <span class="text-sm sm:text-base">Teachlife Rules</span>
            </a>

            <a href="#" class="flex items-center gap-3 mb-2 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <svg class="text-gray-600 flex-shrink-0" fill="currentColor" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"></path>
                    <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"></path>
                </svg>
                <span class="text-sm sm:text-base">Community Chat</span>
            </a>

            <a href="{% url 'contact_us' %}" class="flex items-center gap-3 p-2">
                <span class="text-xs text-gray-400">
                    Techlife @2025.
                    <span class="text-gray-950 hover:underline">All right</span>
                </span>
            </a>
        </div>
    </div>
</div>


<!-- Question Create Modal -->
{% include 'forum/question_modal.html' %}

<!-- Followers Modal -->
<div id="followersModalOverlay" class="question-modal-overlay fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 z-[9999]">
    <div class="question-modal-container bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col shadow-2xl">
        <div class="p-4 sm:p-5 border-b flex items-center justify-between bg-gray-50">
            <h3 class="text-lg sm:text-xl font-bold text-gray-800">Followers</h3>
            <button type="button" onclick="closeModal('followersModalOverlay')" class="question-close-btn w-10 h-10 bg-white shadow-sm rounded-full flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <div class="overflow-y-auto p-4 flex-1 custom-scroll">
            {% if global_followers %} {% for follower in global_followers %}
            <div class="flex items-center justify-between p-3 mb-2 hover:bg-blue-50/50 rounded-xl border border-transparent hover:border-blue-100 transition-all">
                <div class="flex items-center gap-3 min-w-0 flex-1">
                    <img src="{{ follower.profile_picture.url }}" class="w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover border-2 border-white shadow-sm flex-shrink-0">
                    <div class="leading-tight min-w-0">
                        <h4 class="font-bold text-gray-900 text-xs sm:text-sm truncate">{{ follower.first_name }} {{ follower.last_name }}</h4>
                        <p class="text-[10px] sm:text-[11px] text-gray-500 truncate">{{ follower.email }}</p>
                    </div>
                </div>
                <a href="{% url 'forum_user_profile_details' follower.pk %}" class="text-[10px] sm:text-[11px] font-bold py-2 px-3 sm:px-4 rounded-full bg-blue-600 text-white hover:bg-blue-700 transition-colors whitespace-nowrap flex-shrink-0">
                        View
                    </a>
            </div>
            {% endfor %} {% else %}
            <div class="text-center py-10">
                <p class="text-gray-400 italic text-sm">No followers found yet.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Following Modal -->
<div id="followingModalOverlay" class="question-modal-overlay fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 z-[9999]">
    <div class="question-modal-container bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col shadow-2xl">
        <div class="p-4 sm:p-5 border-b flex items-center justify-between bg-gray-50">
            <h3 class="text-lg sm:text-xl font-bold text-gray-800">Following</h3>
            <button type="button" onclick="closeModal('followingModalOverlay')" class="question-close-btn w-10 h-10 bg-white shadow-sm rounded-full flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <div class="overflow-y-auto p-4 flex-1 custom-scroll">
            {% if global_following %} {% for following_user in global_following %}
            <div class="flex items-center justify-between p-3 mb-2 hover:bg-green-50/50 rounded-xl border border-transparent hover:border-green-100 transition-all">
                <div class="flex items-center gap-3 min-w-0 flex-1">
                    <img src="{{ following_user.profile_picture.url }}" class="w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover border-2 border-white shadow-sm flex-shrink-0">
                    <div class="leading-tight min-w-0">
                        <h4 class="font-bold text-gray-900 text-xs sm:text-sm truncate">{{ following_user.first_name }} {{ following_user.last_name }}</h4>
                        <p class="text-[10px] sm:text-[11px] text-gray-500 truncate">{{ following_user.email }}</p>
                    </div>
                </div>
                <a href="{% url 'forum_user_profile_details' following_user.pk %}" class="text-[10px] sm:text-[11px] font-bold py-2 px-3 sm:px-4 rounded-full bg-blue-600 text-white hover:bg-blue-700 transition-colors whitespace-nowrap flex-shrink-0">
                        View
                    </a>
            </div>
            {% endfor %} {% else %}
            <div class="text-center py-10">
                <p class="text-gray-400 italic text-sm">You aren't following anyone.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>





<!-- forum sidebar -->

<script src="{% static 'js/forum_sidebar.js' %}"></script>